<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
    <link rel="stylesheet" href="style1.css">
    <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/src/sha256.js"></script>
</head>
<body onload="randomizeEmojis()">

    <section>
        <div class="container">
            <div class="cont-left">
                <div class="container2">
                    <div id="gridContainer"></div>
                    <br><br>
                    <button id="randomizeBtn">Clear</button>
                </div>
            </div>
            <div class="cont-right">
                <form class="form">
                    <!-- <h3>Welcome to ZERO</h3> -->
                    <p class="sub-heading">Create your account</p>
                    <p class="label">Email Address</p>
                    <input type="email" class="input" id="email" name="email" placeholder="Enter your email" required>
                    <p class="label">Password</p>
                    <input type="password" class="input" id="password" name="password" placeholder="Your password" maxlength="18" required>
    
                    <button type="button" id="submitData" name="submitData" class="registerbtn">Register</button>
                    
                </form>
                <div class="categories"></div>
            </div>
            
            
        </div>

        
        
    </section>
    
</body>
</html>

<!-- <script src="./index.js"></script> -->
<script>
        const url = 'data.json';
    
        const gcontainer = document.getElementById("gridContainer");
        const randomizeBtn = document.getElementById("randomizeBtn");
        const selectedEmoji = document.getElementById("selectedEmoji");
        const emojis = [
            "ðŸ˜€",
            "ðŸ˜ƒ",
            "ðŸ˜„",
            "ðŸ˜",
            "ðŸ˜†",
            "ðŸ˜…",
            "ðŸ˜‚",
            "ðŸ˜Š",
            "ðŸ˜‡",
            "ðŸ¥°",
            "ðŸ˜",
            "ðŸ¤©",
            "ðŸ˜˜",
            "ðŸ˜—",
            "ðŸ˜š",
            "ðŸ˜™",
            "ðŸ˜œ",
            "ðŸ˜",
            "ðŸ˜›",
            "ðŸ¤ª",
            "ðŸ˜Ž",
            "ðŸ¤“",
            "ðŸ˜",
            "ðŸ˜’",
            "ðŸ˜ž",
        ];
        const alphabets = "abcdefghijklmnopqrstuvwxyz".split("");
        let selected = [];

        // Create buttons for each category
        const categoriesDiv = document.querySelector('.categories');
        fetch(url)
        .then(response => response.json())
        .then(data => {
            Object.keys(data).forEach(category => {
            const button = document.createElement('button');
            button.textContent = category;
            button.addEventListener('click', () => generateEmojiGrid(data[category]));
            categoriesDiv.appendChild(button);
            });
        })
        .catch(error => console.error(error));

        // Generate the grid for the selected category
        function generateEmojiGrid(category) {
            const grid = document.querySelector('.gridContainer');
            grid.innerHTML = '';
            const shuffledEmojis = shuffle([...category]);
            for (let i = 0; i < 25; i++) {
                const emoji = shuffledEmojis[i % shuffledEmojis.length];
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.textContent = emoji;
                grid.appendChild(cell);
            }
        }

        // Shuffle function using the Fisher-Yates algorithm
        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Fetch the JSON data from file
        // fetch('emojis.json')
        // .then(response => response.json())
        // .then(data => {
        //     // Get the container for the emojis
        //     const gridContainer = document.getElementById('gridContainer');

        //     // Create options for each category
        //     for (const category in data) {
        //     const option = document.createElement('option');
        //     option.value = category;
        //     option.text = category.charAt(0).toUpperCase() + category.slice(1);
        //     document.getElementById('emojiSelect').add(option);

        //     // Create a grid of emojis for the category
        //     const emojis = data[category];
        //     const grid = document.createElement('div');
        //     grid.classList.add('emoji-grid');
        //     grid.setAttribute('id', category + 'Grid');
        //     for (const emoji of emojis) {
        //         const span = document.createElement('span');
        //         span.innerText = emoji;
        //         grid.appendChild(span);
        //     }
        //     gridContainer.appendChild(grid);
        //     }

        //     // Add event listener for the select element
        //     const select = document.getElementById('emojiSelect');
        //     select.addEventListener('change', (event) => {
        //     const category = event.target.value;
        //     const grids = document.querySelectorAll('.emoji-grid');
        //     grids.forEach(grid => grid.style.display = 'none');
        //     document.getElementById(category + 'Grid').style.display = 'grid';
        //     });
        // })
        // .catch(error => console.error('Error fetching emojis:', error));


        for (let i = 0; i < 25; i++) {
            let div = document.createElement("div");
            div.innerHTML = emojis[i];
            div.setAttribute("data-value", alphabets[i]);
            div.addEventListener("click", function () {
                if (selected.length == 4) {
                    console.log(selected);
                    return;
                }
                if (selected.indexOf(this) === -1) {
                    selected.push(this.getAttribute("data-value"));
                    // selectedEmoji.innerHTML = selected.join("");
                    this.style.backgroundColor = "green";
                } else {
                    selected.splice(selected.indexOf(this), 1);
                    this.style.backgroundColor = "";
                }
                if (selected.length == 4) {
                    console.log(selected);
                    return;
                }
            });
            gcontainer.appendChild(div);

            if ((i + 1) % 5 === 0) {
                gcontainer.appendChild(document.createElement("br"));
            }
        }

        // randomizeBtn.addEventListener("click", function () {
        //     let children = Array.from(gcontainer.children);
        //     let emojisDiv = children.filter((child) => child.tagName === "DIV");

        //     for (let i = 0; i < emojisDiv.length; i++) {
        //         let randomIndex = Math.floor(Math.random() * emojisDiv.length);
        //         let temp = emojisDiv[i].innerHTML;
        //         let tempValue = emojisDiv[i].getAttribute("data-value");
        //         emojisDiv[i].innerHTML = emojisDiv[randomIndex].innerHTML;
        //         emojisDiv[i].setAttribute(
        //             "data-value",
        //             emojisDiv[randomIndex].getAttribute("data-value")
        //         );
        //         emojisDiv[randomIndex].innerHTML = temp;
        //         emojisDiv[randomIndex].setAttribute("data-value", tempValue);
        //         emojisDiv[i].style.backgroundColor = "";
        //     }
        //     selected = [];
        //     selectedEmoji.innerHTML = "";
        // });

        function randomizeEmojis() {
            let children = Array.from(gcontainer.children);
            let emojisDiv = children.filter((child) => child.tagName === "DIV");

            for (let i = 0; i < emojisDiv.length; i++) {
                let randomIndex = Math.floor(Math.random() * emojisDiv.length);
                let temp = emojisDiv[i].innerHTML;
                let tempValue = emojisDiv[i].getAttribute("data-value");
                emojisDiv[i].innerHTML = emojisDiv[randomIndex].innerHTML;
                emojisDiv[i].setAttribute(
                    "data-value",
                    emojisDiv[randomIndex].getAttribute("data-value")
                );
                emojisDiv[randomIndex].innerHTML = temp;
                emojisDiv[randomIndex].setAttribute("data-value", tempValue);
                emojisDiv[i].style.backgroundColor = "";
            }

            selected = [];
            selectedEmoji.innerHTML = "";
        }

    let hashpass = (selected) => {
        const Pass = selected.toString();
        let pass = Pass.replace(new RegExp(",", "g"), "");
        // const password = "secretPassword";
        let hash = sha256(pass);
        console.log(`Password hash: ${hash}`);
        return hash;
    }

</script>

<script>
    
</script>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    // import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    import { getFirestore, collection, addDoc, getDoc, doc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAFIBXh1WnUJ-gTi61ruL4hYYTAngykEYc",
        authDomain: "graphical-authentication-73a5e.firebaseapp.com",
        projectId: "graphical-authentication-73a5e",
        storageBucket: "graphical-authentication-73a5e.appspot.com",
        messagingSenderId: "731182727348",
        appId: "1:731182727348:web:cd08c8d26068088d39d7e1",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    // const database = getDatabase(app);

    const db = getFirestore();

    const colRef = collection(db, 'users');

    // getDocs(colRef)
    //     .then((snapshot) => {
    //         let books = [];
    //         snapshot.docs.forEach((doc) => {
    //             books.push({...doc.data(), id: doc.id});
    //         })

    //         console.log(books);
    //     })
    //     .catch(err => {
    //         console.log(err.message);
    //     })

    let submitData = document.querySelector("#submitData");
    let form = document.querySelector(".form");
    submitData.addEventListener('click', (e) =>{
        const email = form.email.value;
        const password = form.password.value;
        let ans = hashpass(selected);

        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            console.log(user.uid);
            addDoc(colRef, {
                email: email,
                grid_pass: ans,
                password: password
            })
            .then(() => {
                alert("sign up successful");
                form.reset();
                location.replace("../login-page/welcome.html")
            })
        })
        .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            // ..
            alert(errorMessage);
        });
    })

    // const q = query(colRef, where("email", "==", "anumishra@gmail.com"))

    // onSnapshot(q, (snapshot) => {
    //     let ans = []
    //     snapshot.docs.forEach((doc) => {
    //         ans.push({...doc.data(), id: doc.id})
    //     })
        
    //     console.log(ans[0].grid_pass)
    // })


</script>
